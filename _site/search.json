[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "ANDRE-S-BLOG",
    "section": "",
    "text": "Atividade 2 - Monitoramento de Frota de Ônibus\n\n\n\nAPI\n\nPYTHON\n\nCODE\n\n\n\n\n\n\n\n\n\nNov 23, 2025\n\n\nAndré Bellin\n\n\n\n\n\n\n\n\n\n\n\n\nAtividae 1 - Cotação Dolar\n\n\n\nJSON\n\nPYTHON\n\nCODE\n\n\n\n\n\n\n\n\n\nNov 23, 2025\n\n\nAndré Bellin\n\n\n\n\n\nNo matching items"
  },
  {
    "objectID": "posts/post-with-code/index.html",
    "href": "posts/post-with-code/index.html",
    "title": "Atividae 1 - Cotação Dolar",
    "section": "",
    "text": "Neste Post irei mostrar como fazer uma catação do valor do Dolar com base em uma data específica.\n\nimport pandas as pd\nimport requests\nimport calendar\nfrom datetime import datetime\nimport plotly.express as px\n\ndef cotacao_dolar_periodo(mmyyyy: str):\n    \"\"\"\n    Recebe uma string no formato 'MMYYYY' e retorna\n    um gráfico de linha com as cotações diárias do dólar PTAX.\n    \"\"\"\n\n    first_date = datetime.strptime(mmyyyy, \"%m%Y\")\n    last_date = first_date.replace(\n        day = calendar.monthrange(first_date.year, first_date.month)[1]\n    )\n\n    # Converter para formato exigido pela API: mm-dd-yyyy\n    data_ini = first_date.strftime(\"%m-%d-%Y\")\n    data_fim = last_date.strftime(\"%m-%d-%Y\")\n\n    # 2  Montar URL da API PTAX  Cotação por Período\n    url = (\n        \"https://olinda.bcb.gov.br/olinda/servico/PTAX/versao/v1/odata/\"\n        \"CotacaoDolarPeriodo(dataInicial=@dataInicial,dataFinalCotacao=@dataFinalCotacao)\"\n        f\"?@dataInicial='{data_ini}'&@dataFinalCotacao='{data_fim}'\"\n        \"&$top=100&$format=json\"\n    )\n\n    # 3  Requisição\n    response = requests.get(url)\n    dados = response.json()[\"value\"]\n\n    # 4  Criar DataFrame\n    df = pd.DataFrame(dados)\n    df[\"data\"] = pd.to_datetime(df[\"dataHoraCotacao\"]).dt.date\n    df = df[[\"data\", \"cotacaoCompra\", \"cotacaoVenda\"]]\n\n    # 5  Remover duplicados e ordenar\n    df = df.groupby(\"data\").mean().reset_index()\n    df = df.sort_values(\"data\")\n\n    # 6  Preencher feriados e finais de semana (forward-fill)\n    idx = pd.date_range(start=first_date, end=last_date)\n    df = df.set_index(\"data\").reindex(idx)\n    df = df.fillna(method=\"ffill\")\n    df.index.name = \"data\"\n    df = df.reset_index()\n\n    # 7  Plotly\n    fig = px.line(\n        df,\n        x=\"data\",\n        y=\"cotacaoVenda\",\n        title=f\"Cotação do Dólar  {mmyyyy[:2]}/{mmyyyy[2:]}\",\n        labels={\"cotacaoVenda\": \"Cotação (Venda)\", \"data\": \"Data\"}\n    )\n\n    fig.update_layout(yaxis_tickformat=\".2f\")\n    return fig\n\n# Executando para sua data 07/2016\n\ncotacao_dolar_periodo(\"072016\")\n\n/tmp/ipykernel_27938/1546896907.py:46: FutureWarning:\n\nDataFrame.fillna with 'method' is deprecated and will raise in a future version. Use obj.ffill() or obj.bfill() instead."
  },
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "About",
    "section": "",
    "text": "About this blog"
  },
  {
    "objectID": "posts/welcome/index.html",
    "href": "posts/welcome/index.html",
    "title": "Welcome To My Blog",
    "section": "",
    "text": "This is the first post in a Quarto blog. Welcome!\n\nSince this post doesn’t specify an explicit image, the first image in the post will be used in the listing page of posts."
  },
  {
    "objectID": "posts/onibus/index.html",
    "href": "posts/onibus/index.html",
    "title": "Atividade 2 - Monitoramento de Frota de Ônibus",
    "section": "",
    "text": "This is the first post in a Quarto blog. Welcome!\n\n# Versão robusta: usa token SPTRANS_TOKEN se disponível; caso contrário usa dados de demonstração.\nimport os\nimport requests\nfrom dotenv import load_dotenv\nfrom IPython.display import HTML, display\nimport folium\nimport math\n\nload_dotenv()\ntoken = os.getenv(\"SPTRANS_TOKEN\")\n\ns = requests.Session()\n\n# Dados de demonstração (fallback quando não há token ou falha na API)\ndemo_paradas = [\n    {\"cp\": 7014417, \"np\": \"ANGELICA B/C\", \"ed\": \"AV ANGELICA\", \"py\": -23.534564, \"px\": -46.654302},\n    {\"cp\": 60016784, \"np\": \"PARADA PALMEIRAS B/C\", \"ed\": \"R PADRE ANTONIO TOMAS\", \"py\": -23.525799, \"px\": -46.679251},\n    {\"cp\": 60016786, \"np\": \"ANTARTICA B/C\", \"ed\": \"PC SOUSA ARANHA\", \"py\": -23.526523, \"px\": -46.673588},\n    {\"cp\": 12783, \"np\": \"PARADA D\", \"ed\": \"R EXEMPLO\", \"py\": -23.535317, \"px\": -46.653005},\n]\n\ndemo_pos = [\n    {\"p\": \"12783\", \"ta\": \"2024-09-27T01:05:47Z\", \"py\": -23.53531725, \"px\": -46.653005},\n    {\"p\": \"12534\", \"ta\": \"2024-09-27T01:06:10Z\", \"py\": -23.547649, \"px\": -46.6410115},\n]\n\ndef fetch_paradas_pos(codigo_linha=2506):\n    \"\"\"Tenta buscar paradas e posições da API; retorna (paradas, pos_list).\n    Em caso de erro ou token ausente, retorna dados de demonstração.\"\"\"\n    if not token:\n        print(\"SPTRANS_TOKEN não encontrado — usando dados de demonstração.\")\n        return demo_paradas, demo_pos\n\n    try:\n        # Autenticar (algumas versões da API usam POST/GET — mantemos POST como exemplo)\n        auth = s.post(f\"https://api.olhovivo.sptrans.com.br/v2.1/Login/Autenticar?token={token}\", timeout=10)\n        print(\"Login response:\", auth.text)\n\n        # Buscar paradas da linha\n        r_par = s.get(f\"https://api.olhovivo.sptrans.com.br/v2.1/Parada/BuscarParadasPorLinha?codigoLinha={codigo_linha}\", timeout=10)\n        paradas = r_par.json()\n\n        # Buscar posições dos veículos\n        r_pos = s.get(f\"https://api.olhovivo.sptrans.com.br/v2.1/Posicao/Linha?codigoLinha={codigo_linha}\", timeout=10)\n        pos_json = r_pos.json()\n        pos_list = pos_json.get(\"vs\") if isinstance(pos_json, dict) else []\n\n        if not paradas:\n            print(\"API retornou 0 paradas — usando dados de demonstração.\")\n            return demo_paradas, demo_pos\n\n        return paradas, pos_list\n\n    except Exception as e:\n        print(\"Erro ao acessar API Olho Vivo:\", e)\n        print(\"Usando dados de demonstração.\")\n        return demo_paradas, demo_pos\n\n\nparadas, pos_list = fetch_paradas_pos(codigo_linha=2506)\n\nprint(f\"Usando {len(paradas)} paradas e {len(pos_list)} posições (veículos).\")\n\n# Calcular centro do mapa (média das coordenadas)\ndef mean_center(points):\n    lat = [p[\"py\"] for p in points]\n    lon = [p[\"px\"] for p in points]\n    return (sum(lat) / len(lat), sum(lon) / len(lon))\n\ncenter = mean_center(paradas) if paradas else (-23.534564, -46.654302)\n\n# Construir mapa com Folium\nm = folium.Map(location=center, zoom_start=14)\n\nfor p in paradas:\n    folium.Marker(location=[p[\"py\"], p[\"px\"]], popup=f\"{p.get('np')}\\n{p.get('ed','')}\").add_to(m)\n\n# Adicionar posições dos veículos (se houver)\nfor v in pos_list:\n    try:\n        folium.CircleMarker(location=[v[\"py\"], v[\"px\"]], radius=6, color=\"red\", fill=True, fill_opacity=0.8,\n                            popup=f\"Veículo: {v.get('p')}\\nHora: {v.get('ta')}\").add_to(m)\n    except Exception:\n        pass\n\n# Salvar HTML e embutir no output do Quarto\noutput = f\"paradas_linha_2506.html\"\nm.save(output)\nprint(f\"Mapa salvo em: {output}\")\n\n# Embutir o mapa diretamente no documento Quarto\ndisplay(HTML(m._repr_html_()))\n\nSPTRANS_TOKEN não encontrado — usando dados de demonstração.\nUsando 4 paradas e 2 posições (veículos).\nMapa salvo em: paradas_linha_2506.html\n\n\nMake this Notebook Trusted to load map: File -&gt; Trust Notebook"
  }
]